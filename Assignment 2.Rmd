---
title: "Assignment 2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Quantitative Methods in Public Policy Assignment 2

**5.1) Run a regression with earnings as the dependent variable and schooling as the sole independent variable. Interpret the coefficients.** 

**5.2) Suppose you wanted a parsimonious way to predict earnings using only years of schooling. What would you do?**

**5.3) Let’s dig more deeply into whether the relationship between earning and schooling is approximately linear.**

**a) Start by making a scatter plot. Then plot the predicted values from your regression along with the raw data points, as we did in chapter 2. Does the regression line look like it’s fitting the data well?**

**b) Now run a fourth-order polynomial regression (i.e., including schooling, schooling squared, schooling to the third, and schooling to the fourth). Do those predictions meaningfully differ from the predictions coming from the linear regression?**

**c) Now run different regressions for some different ranges of schooling. Do those lines look meaningfully different from the predictions you get from a single regression including all the data?**

**d) Does all this make you think the simple linear approach was reasonable or unreasonable?**

**5.4) Similar to what we did with age and voter turnout, conduct some out-of-sample tests to evaluate your prediction strategy. Using only data from those with twelve years of schooling or less, see how well your different strategies from question 3 perform when predicting earnings for those with more than twelve years of schooling.**

**5.5). Drop one observation, run a regression to try to predict the outcome for that missing observation, and see how far you were. Repeat this for each observation in the data set (you should be able to do this with a loop) and average your errors. Try different strategies to see which one gives you the best out-of-sample predictions.**


```{r code}

# configure figures for aesthetics
knitr::opts_chunk$set(echo = TRUE, fig.width = 12, fig.height = 8)

# install requisite packages
# install.packages(tidyverse)
# install.packages(rvest)
# install.packages(RColorBrewer)
# install.packages(tidytext)
# install.packages(knitr)
# install.packages(downloader)
# install.packages(here)

# save requisite packages to library
library(tidyverse)
library(rvest)
library(RColorBrewer)
library(tidytext)
library(knitr)
library(downloader)
library(here)

# show explainer of data for future reference (from the associated read_me)
# "Angrist and Krueger obtained their data from the Integrated Public Use
# Microdata Series from the 1980 U.S. Census.

# The study specifically focused on men born between 1930 and 1939, so they
# were 41-50 years old at the time of data collection.

# Each row corresponds to a large group of men with the same level of
# schooling.

# The variable "schooling" indicates the years of schooling for each group.
# 12 corresponds with high school completion, and 16 corresponds with 
# college completion.

# The variable "earnings" indicates the average annual earnings (in 1980
# U.S. dollars) for the men in each group."

# save data to variable
schooling_data <- read.csv(here("Files for Data Exercises/SchoolingEarnings.csv"))
  # note here() removes the need to set a working directory by X

# fit a regression line
regression <- lm(data = schooling_data, earnings ~ schooling)
summary(regression)

# visualize data in a scatter plot with a regression line
schooling_data %>% 
  ggplot(aes(x = schooling, y = earnings)) + 
  geom_point() + 
  geom_smooth(method = lm)

# visualize data in a scatter plot with a fourth-order regression
schooling_data %>% 
  ggplot(aes(x = schooling, y = earnings)) + 
  geom_point() + 
  geom_smooth(method = lm, se = TRUE,
              formula = y ~ poly(x, 4, raw=TRUE))

# visualize data in a scatter plot with a segmented regression
schooling_data %>% 
  ggplot(aes(x = schooling, y = earnings, group = )) + 
  geom_point() + 
  geom_smooth(method = lm, se = TRUE,
              formula = y ~ poly(x, 4, raw=TRUE))


#separate data frame into three groups and append group number
schooling_elem <- schooling_data %>%
  filter(schooling < 6) %>% 
  mutate(group = 1)

schooling_college <- schooling_data %>%
  filter(5 < schooling & schooling < 16) %>% 
  mutate(group = 2)

schooling_post <- schooling_data %>% 
  filter(15 < schooling) %>% 
  mutate(group = 3)

schooling_final <- schooling_elem %>% 
  full_join(schooling_college) %>% 
  full_join(schooling_post)

# plot segmented linear regression for three buckets of schooling
schooling_final %>% 
  ggplot(aes(x = schooling, y = earnings)) + 
  geom_point() + 
  geom_smooth(aes(group = group), method = lm)

```
